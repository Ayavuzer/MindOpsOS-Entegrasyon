# E6-S1: Background Processing Endpoint

**Epic:** E6 - Automation Pipeline  
**Story Points:** 3  
**Status:** Review  
**Sprint:** 2  

---

## User Story

**As a** tenant admin  
**I want** a simple endpoint to trigger full processing  
**So that** I can automate fetch → parse → sync pipeline  

---

## Acceptance Criteria

1. ✅ **AC1:** Single endpoint to trigger full pipeline
2. ✅ **AC2:** Fetch emails → Parse → Sync to Sedna in one call
3. ✅ **AC3:** Return detailed processing results

---

## Tasks / Subtasks

- [x] Task 1: Create processing service (AC: #1-2)
- [x] Task 2: Create processing endpoint (AC: #3)

---

## File List

### Backend (apps/api/processing/)

- `__init__.py` - Created
- `service.py` - Created (ProcessingService)
- `routes.py` - Created (run endpoint)

### Modified

- `apps/api/main.py` - Added processing router and service

---

## API Endpoints

| Endpoint | Method | Auth | Description |
|----------|--------|------|-------------|
| `/api/processing/run` | POST | ✓ | Run full pipeline |
| `/api/processing/history` | GET | ✓ | Get processing history |

---

## Response Model

```json
{
  "success": true,
  "message": "Fetched 5 emails, synced 3 items",
  "booking_emails_fetched": 3,
  "stopsale_emails_fetched": 2,
  "reservations_synced": 2,
  "stop_sales_synced": 1,
  "errors": [],
  "duration_seconds": 2.345
}
```

---

## Pipeline Flow

```
POST /api/processing/run
    │
    ├─→ 1. Fetch Booking Emails (POP3)
    │
    ├─→ 2. Fetch Stop Sale Emails (POP3)
    │
    ├─→ 3. Sync Pending to Sedna
    │
    └─→ Return Combined Results
```

---

## Dev Agent Record

### Agent Model Used

Antigravity

### Completion Notes

- ProcessingService orchestrates TenantEmailService and TenantSednaService
- Single endpoint triggers full fetch → sync pipeline
- Returns comprehensive stats with duration
- Optional processing_logs table for history tracking
