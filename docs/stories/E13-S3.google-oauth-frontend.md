# Story: E13-S3 - Google OAuth Flow - Frontend

> **Epic:** E13 - Advanced Email Integration
> **Story Points:** 5
> **Priority:** P1
> **Status:** ✅ Done

---

## User Story

**As a** tenant admin  
**I want** a "Connect with Google" button  
**So that** I can easily link my Gmail account

---

## Acceptance Criteria

- [x] **AC1:** OAuth connect button in Settings
- [x] **AC2:** Popup/redirect flow handling
- [x] **AC3:** Success/error feedback
- [x] **AC4:** Connected status display
- [x] **AC5:** Disconnect option

---

## Technical Notes

### Component Architecture

```
Settings Page (page.tsx)
├── GoogleOAuthConnect (reusable component)
│   ├── Auth Method Toggle (Password / OAuth 2.0)
│   ├── Connect with Google Button
│   ├── Connected Status Display
│   └── Disconnect Button
```

### UI Features

| Feature | Implementation |
|---------|----------------|
| Auth Toggle | Two buttons: "Password" and "OAuth 2.0" |
| Google Button | White button with Google logo |
| Connected State | Green checkmark with email display |
| Disconnect | Red button with unlink icon |
| Error States | Red alert with error message |
| Success States | Green alert with success message |

### OAuth Flow (Frontend)

```
1. User clicks "OAuth 2.0" toggle
2. Component shows "Connect with Google" button
3. User clicks button → POST /api/oauth/google/authorize
4. Redirect to Google consent screen
5. Google redirects to /api/oauth/google/callback
6. Backend redirects to /settings?oauth_success=true&email=...
7. Frontend shows success message & refreshes settings
```

---

## Tasks / Subtasks

- [x] Task 1: GoogleOAuthConnect Component (AC: #1, #4, #5)
  - [x] Auth method toggle UI
  - [x] Connect button with Google logo
  - [x] Connected status display
  - [x] Disconnect functionality

- [x] Task 2: URL Callback Handling (AC: #2, #3)
  - [x] Parse oauth_success/oauth_error from URL
  - [x] Display success/error messages
  - [x] Clear URL params after handling

- [x] Task 3: Settings Page Integration (AC: #1-5)
  - [x] Add types for OAuth to EmailConfig
  - [x] Integrate component for Booking Email
  - [x] Integrate component for Stop Sale Email
  - [x] Update header labels (POP3 → IMAP)

- [x] Task 4: Build & Deploy (AC: #1-5)
  - [x] npm run build verification
  - [x] Docker image build (v1.0.6-oauth)
  - [x] Kubernetes deployment

- [x] Task 5: Browser Test (AC: #1-5)
  - [x] Login and navigate to Settings
  - [x] Verify OAuth toggle visibility
  - [x] Verify Connect button display
  - [x] Screenshot capture

---

## File List

| File | Action | Description |
|------|--------|-------------|
| `apps/web/src/components/GoogleOAuthConnect.tsx` | Created | Reusable OAuth connect component |
| `apps/web/src/app/settings/page.tsx` | Modified | OAuth integration & IMAP labels |
| `docs/stories/E13-S3.google-oauth-frontend.md` | Created | This story file |

---

## Dev Agent Record

### Agent Model Used

Antigravity + Aria Vega (UI/Frontend)

### Completion Notes

- OAuth toggle UI properly styled with gradient effect
- Google logo embedded as SVG for consistent rendering
- Connected state shows email and expiry info
- Error/success alerts with proper color coding
- Deployed as entegrasyon-web:v1.0.6-oauth
- Browser test confirmed all elements visible

### Design Decisions

1. **Auth Method Toggle:** Decided on button toggle instead of dropdown for better visibility
2. **Google Button:** Used Google's branded colors (white bg, multicolor logo)
3. **Connected State:** Shows green checkmark with email, token expiry info
4. **Disconnect:** Red-themed button with confirmation

### Screenshots

Browser test confirmed:

- Settings page shows OAuth toggle for both Booking and Stop Sale Email
- "Connect with Google" button properly styled
- Auth method toggle switches between Password and OAuth 2.0

---

## Dependencies

### Depends On

- E13-S2: Google OAuth Backend ✅

### Enables

- E13-S4: Token Refresh Mechanism
- Full OAuth authentication flow

---

*Completed: 2025-12-28*
