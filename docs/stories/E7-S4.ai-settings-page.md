# E7.S4: AI Settings Page

## Story Info

| Field | Value |
|-------|-------|
| Story ID | E7.S4 |
| Epic | E7: AI Frontend Integration |
| SP | 1 |
| Priority | P2 |
| Status | Done |
| Depends On | E7.S1 (AI Status) |

---

## User Story

**As an** admin  
**I want** to view AI configuration settings  
**So that** I can understand the AI system status

---

## Acceptance Criteria

- [x] AI Settings page accessible at `/settings/ai`
- [x] Shows AI service status (active/offline)
- [x] Shows current model name (gemini-2.0-flash)
- [x] Shows supported languages (TR, EN, RU, DE, UK)
- [x] Shows confidence threshold (0.85)
- [x] Shows fallback mechanism (Regex Parser)
- [x] Navigation link from settings menu

---

## Technical Tasks

### Task 1: Create AI Settings Page

**File:** `app/settings/ai/page.tsx`

```typescript
"use client";

import { useState, useEffect } from "react";
import { 
    Brain, 
    Settings, 
    Globe, 
    Gauge, 
    Code, 
    Loader2,
    CheckCircle,
    XCircle 
} from "lucide-react";
import { getAIStatus, AIStatus } from "@/lib/api/ai";

export default function AISettingsPage() {
    const [status, setStatus] = useState<AIStatus | null>(null);
    const [loading, setLoading] = useState(true);

    useEffect(() => {
        const fetchStatus = async () => {
            try {
                const data = await getAIStatus();
                setStatus(data);
            } catch {
                setStatus({ available: false, model: null });
            } finally {
                setLoading(false);
            }
        };
        fetchStatus();
    }, []);

    return (
        <div className="space-y-6">
            {/* Header */}
            <div>
                <h1 className="text-2xl font-bold text-white">AI Settings</h1>
                <p className="text-slate-400 mt-1">
                    Manage AI-powered email parsing configuration
                </p>
            </div>

            {/* AI Status Card */}
            <div className="bg-slate-900 border border-slate-800 rounded-xl p-6">
                <div className="flex items-center gap-3 mb-4">
                    <div className={`w-10 h-10 rounded-lg flex items-center justify-center ${
                        status?.available ? "bg-emerald-500/20" : "bg-red-500/20"
                    }`}>
                        <Brain className={`w-5 h-5 ${
                            status?.available ? "text-emerald-400" : "text-red-400"
                        }`} />
                    </div>
                    <div>
                        <h3 className="text-lg font-semibold text-white">AI Service Status</h3>
                        <p className="text-sm text-slate-400">Gemini AI integration</p>
                    </div>
                </div>

                {loading ? (
                    <div className="flex items-center gap-2 text-slate-400">
                        <Loader2 className="w-4 h-4 animate-spin" />
                        <span>Checking status...</span>
                    </div>
                ) : (
                    <div className="flex items-center gap-2">
                        {status?.available ? (
                            <>
                                <CheckCircle className="w-5 h-5 text-emerald-400" />
                                <span className="text-emerald-400 font-medium">Active</span>
                                {status.model && (
                                    <span className="text-slate-400 ml-2">({status.model})</span>
                                )}
                            </>
                        ) : (
                            <>
                                <XCircle className="w-5 h-5 text-red-400" />
                                <span className="text-red-400 font-medium">Offline</span>
                            </>
                        )}
                    </div>
                )}
            </div>

            {/* Configuration Cards */}
            <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                {/* Model Info */}
                <div className="bg-slate-900 border border-slate-800 rounded-xl p-6">
                    <div className="flex items-center gap-2 mb-4">
                        <Settings className="w-5 h-5 text-slate-400" />
                        <h3 className="text-lg font-semibold text-white">Model Configuration</h3>
                    </div>
                    <div className="space-y-3">
                        <div className="flex justify-between">
                            <span className="text-slate-400">Provider</span>
                            <span className="text-white">Google AI</span>
                        </div>
                        <div className="flex justify-between">
                            <span className="text-slate-400">Model</span>
                            <span className="text-white">Gemini 2.0 Flash</span>
                        </div>
                        <div className="flex justify-between">
                            <span className="text-slate-400">Version</span>
                            <span className="text-white">v1.9.1-e6</span>
                        </div>
                    </div>
                </div>

                {/* Supported Languages */}
                <div className="bg-slate-900 border border-slate-800 rounded-xl p-6">
                    <div className="flex items-center gap-2 mb-4">
                        <Globe className="w-5 h-5 text-slate-400" />
                        <h3 className="text-lg font-semibold text-white">Supported Languages</h3>
                    </div>
                    <div className="flex flex-wrap gap-2">
                        {["Turkish", "English", "Russian", "German", "Ukrainian"].map((lang) => (
                            <span 
                                key={lang}
                                className="px-3 py-1 bg-slate-800 text-slate-300 rounded-full text-sm"
                            >
                                {lang}
                            </span>
                        ))}
                    </div>
                </div>

                {/* Confidence Threshold */}
                <div className="bg-slate-900 border border-slate-800 rounded-xl p-6">
                    <div className="flex items-center gap-2 mb-4">
                        <Gauge className="w-5 h-5 text-slate-400" />
                        <h3 className="text-lg font-semibold text-white">Confidence Threshold</h3>
                    </div>
                    <div className="space-y-3">
                        <div className="flex justify-between items-center">
                            <span className="text-slate-400">Minimum threshold</span>
                            <span className="text-2xl font-bold text-emerald-400">85%</span>
                        </div>
                        <p className="text-xs text-slate-500">
                            AI extractions below this threshold will fallback to regex parser
                        </p>
                    </div>
                </div>

                {/* Fallback Mechanism */}
                <div className="bg-slate-900 border border-slate-800 rounded-xl p-6">
                    <div className="flex items-center gap-2 mb-4">
                        <Code className="w-5 h-5 text-slate-400" />
                        <h3 className="text-lg font-semibold text-white">Fallback Mechanism</h3>
                    </div>
                    <div className="space-y-3">
                        <div className="flex justify-between">
                            <span className="text-slate-400">Fallback method</span>
                            <span className="text-white">Regex Parser</span>
                        </div>
                        <div className="flex justify-between">
                            <span className="text-slate-400">Triggers</span>
                            <span className="text-white">AI failure or low confidence</span>
                        </div>
                    </div>
                </div>
            </div>

            {/* Info Banner */}
            <div className="bg-blue-500/10 border border-blue-500/30 rounded-xl p-4">
                <p className="text-blue-400 text-sm">
                    <strong>Note:</strong> AI configuration is managed at the system level. 
                    Contact your administrator to modify these settings.
                </p>
            </div>
        </div>
    );
}
```

### Task 2: Add Settings Navigation

**File:** `app/settings/page.tsx` (or navigation component)

Add link to AI settings page:

```typescript
<Link href="/settings/ai" className="...">
    <Brain className="w-4 h-4" />
    AI Settings
</Link>
```

---

## Testing Checklist

- [ ] Page accessible at /settings/ai
- [ ] AI status shown correctly (active/offline)
- [ ] Model information displayed
- [ ] Supported languages shown
- [ ] Threshold value displayed
- [ ] Fallback mechanism explained
- [ ] Info banner visible
- [ ] Responsive on mobile

---

## Files to Create/Modify

| File | Action | Purpose |
|------|--------|---------|
| `app/settings/ai/page.tsx` | Create | Settings page |
| `app/settings/page.tsx` | Modify | Add navigation link |

---

## Definition of Done

- [x] All acceptance criteria met
- [x] Page renders correctly
- [x] Status fetched from API
- [x] All sections displayed
- [x] No TypeScript errors
- [ ] Code committed to git

---

## File List

| File | Action | Status |
|------|--------|--------|
| `src/app/settings/ai/page.tsx` | Created | ✅ |
| `src/app/settings/page.tsx` | Modified | ✅ |

---

## Dev Agent Record

### Agent Model Used

Antigravity + Aria Vega (Design)

### Completion Notes

- Created AI Settings page with modern UI
- Displays AI status, model info, supported languages, threshold, fallback
- Added refresh button for status check
- Added navigation card to settings page
- TypeScript check passed

### Completed At

2025-12-31T14:25:00+03:00
