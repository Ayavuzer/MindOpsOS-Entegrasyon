# E2-S1: Tenant Settings API & UI

**Epic:** E2 - Tenant Settings  
**Story Points:** 5  
**Status:** Review  
**Sprint:** 1-2  

---

## User Story

**As a** tenant admin  
**I want** to configure my email and Sedna API credentials  
**So that** the system can connect to my integrations  

---

## Acceptance Criteria

1. ✅ **AC1:** `GET /api/tenant/settings` endpoint çalışıyor
2. ✅ **AC2:** `PUT /api/tenant/settings` endpoint çalışıyor
3. ✅ **AC3:** Credentials Fernet ile encrypted saklanıyor
4. ✅ **AC4:** `POST /api/tenant/test/email` bağlantı testi
5. ✅ **AC5:** `POST /api/tenant/test/sedna` bağlantı testi
6. ✅ **AC6:** Settings UI sayfası var
7. ✅ **AC7:** Form güncellemesi çalışıyor
8. ✅ **AC8:** Test butonları çalışıyor

---

## Tasks / Subtasks

- [x] Task 1: Encryption module (AC: #3)
- [x] Task 2: Tenant settings service + routes (AC: #1-2, #4-5)
- [x] Task 3: Settings UI page (AC: #6-8)

---

## File List

### Backend (apps/api/tenant/)

- `__init__.py` - Created
- `encryption.py` - Created (Fernet encrypt/decrypt)
- `models.py` - Created (Pydantic models)
- `service.py` - Created (TenantSettingsService)
- `routes.py` - Created (GET/PUT settings, POST test)

### Frontend (apps/web/src/app/)

- `settings/page.tsx` - Completely rewritten

### Modified

- `apps/api/main.py` - Added tenant router and service

---

## API Endpoints

| Endpoint | Method | Description |
|----------|--------|-------------|
| `/api/tenant/settings` | GET | Get settings (no passwords) |
| `/api/tenant/settings` | PUT | Update settings |
| `/api/tenant/test/email?email_type=booking|stopsale` | POST | Test email connection |
| `/api/tenant/test/sedna` | POST | Test Sedna API |

---

## UI Features

- Booking Email configuration (POP3)
- Stop Sale Email configuration (POP3)
- Sedna API configuration
- Processing settings (interval, auto-process)
- Password visibility toggle
- "Password saved" indicator
- Test Connection buttons with status
- Save Settings button

---

## Dev Agent Record

### Agent Model Used

Antigravity

### Completion Notes

- Full tenant settings module created
- Fernet encryption for stored passwords
- Settings saved securely in tenant_settings table
- Connection tests use decrypted credentials
- UI rewritten with form state management
- All endpoints auth-protected
- Dependencies: cryptography (for Fernet)
